<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’– My Best Person Ever ğŸ’–</title>
<style>
body {
  font-family: 'Comic Sans MS', cursive, sans-serif;
  background: url('background.jpg') no-repeat center center fixed;
  background-size: cover;
  text-align: center;
  padding: 40px;
  color: white;
}
h1 { font-size: 2.5em; text-shadow: 2px 2px 5px deeppink; }
.section {
  background: rgba(255,105,180,0.7);
  padding: 20px;
  border-radius: 20px;
  margin: 20px auto;
  max-width: 500px;
}
button {
  background: hotpink;
  border: none;
  padding: 10px 20px;
  margin: 10px;
  border-radius: 10px;
  color: white;
  font-weight: bold;
  cursor: pointer;
}
input { padding: 8px; border-radius: 8px; border: none; margin:5px; }
.countdown { font-size:1.3em; margin-top:15px; color:#fff; text-shadow:1px 1px 3px darkred; }
img { width: 250px; border-radius: 15px; border: 3px solid white; margin:10px 0; }
audio { margin:10px 0; }
</style>
</head>
<body>

<h1>ğŸ’– My Best Person Ever ğŸ’–</h1>

<!-- PAGE 1: Password -->
<div class="section" id="page1">
  <h2>Enter Password to Continue ğŸ’Œ</h2>
  <input type="text" id="passwordInput" placeholder="Hint: My Birthday">
  <button id="passwordBtn">Submit ğŸ”‘</button>
</div>

<!-- PAGE 2: Favorite Photo + Countdown -->
<div class="section" id="page2" style="display:none;">
  <div class="countdown" id="photoCountdown"></div>
  <h2>Our Favorite Photo ğŸ¥°</h2>
  <img src="https://rpkfjjt9tx-del.github.io/Best/photo1.jpg" alt="Our Favorite Photo">
  <br>
  <button onclick="goToQuestions()">Next â¡ï¸</button>
  <button onclick="goBack(1)">Back â¬…ï¸</button>
</div>

<!-- PAGE 3: Questions + Upload -->
<div class="section" id="page3" style="display:none;">
  <h2>Answer This ğŸ’•</h2>
  <p>Do you love me? â¤ï¸</p>
  <input type="text" id="love"><br>
  <p>Most special moment with me? ğŸ¥°</p>
  <input type="text" id="moment"><br>

  <h3>Upload a Photo ğŸ“¸ (optional)</h3>
  <input type="file" id="photoUpload" accept="image/*"><br>
  
  <h3>Record Voice Note ğŸ¤ (optional)</h3>
  <button onclick="recordVoice()">Record / Stop</button>
  <audio id="audioPlayer" controls style="display:none;"></audio><br>

  <button onclick="submitData()">Submit ğŸ’Œ</button>
  <button onclick="goBack(2)">Back â¬…ï¸</button>
</div>

<!-- PAGE 4: Surprise + Message -->
<div class="section" id="page4" style="display:none;">
  <h2>ğŸ’– Surprise! ğŸ’–</h2>
  <img src="https://rpkfjjt9tx-del.github.io/Best/surprise.jpg" alt="Surprise Photo"><br><br>
  <p>
    I just want you to know that you are truly a special person ğŸŒŸ.  
    Thereâ€™s something about you thatâ€™s unlike anyone else Iâ€™ve ever met ğŸ’– â€”  
    your kindness, your smile ğŸ˜Š, the way you make people feel seen and valued ğŸŒˆ.  
    You hold a special place in my heart â¤ï¸, and I canâ€™t help but admire everything that makes you uniquely you âœ¨.  
    The world feels brighter just because youâ€™re in it â˜€ï¸, and I hope you never forget how important and amazing you are ğŸŒ¹ğŸ’«.
  </p>
  <button onclick="goBack(3)">Back â¬…ï¸</button>
</div>

<script>
// Password Lock
document.getElementById("passwordBtn").addEventListener("click", ()=>{
  const val = document.getElementById("passwordInput").value;
  if(val === "14122005"){
    showPage2();
  } else alert("âŒ Wrong password! Hint: My Birthday");
});

// Countdown from August 21, 2024
function showPage2(){
  document.getElementById("page1").style.display="none";
  document.getElementById("page2").style.display="block";
  const countdownEl=document.getElementById("photoCountdown");
  const startDate=new Date("2024-08-21T00:00:00");

  setInterval(()=>{
    const now=new Date();
    const diff=now - startDate;
    const days  = Math.floor(diff/1000/60/60/24);
    const hours = Math.floor((diff/1000/60/60)%24);
    const mins  = Math.floor((diff/1000/60)%60);
    const secs  = Math.floor((diff/1000)%60);
    countdownEl.textContent = `Together for: ${days}d ${hours}h ${mins}m ${secs}s`;
  },1000);
}

// Navigation
function goToQuestions(){
  document.getElementById("page2").style.display="none";
  document.getElementById("page3").style.display="block";
}
function goBack(page){
  document.getElementById("page1").style.display="none";
  document.getElementById("page2").style.display="none";
  document.getElementById("page3").style.display="none";
  document.getElementById("page4").style.display="none";
  if(page===1) document.getElementById("page1").style.display="block";
  if(page===2) document.getElementById("page2").style.display="block";
  if(page===3) document.getElementById("page3").style.display="block";
}

// Voice record
let recorder, audioBlob;
async function recordVoice(){
  if(!recorder){
    const stream = await navigator.mediaDevices.getUserMedia({audio:true});
    recorder = new MediaRecorder(stream);
    const chunks=[];
    recorder.ondataavailable=e=>chunks.push(e.data);
    recorder.onstop=()=>{
      audioBlob=new Blob(chunks,{type:'audio/ogg'});
      const p=document.getElementById("audioPlayer");
      p.src=URL.createObjectURL(audioBlob);
      p.style.display="block";
    };
  }
  recorder.state==="recording"? recorder.stop() : recorder.start();
}

// Convert file to Base64
function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    const r=new FileReader();
    r.onload=()=>resolve(r.result);
    r.onerror=err=>reject(err);
    r.readAsDataURL(file);
  });
}

// Submit to SheetDB
async function submitData(){
  const love = document.getElementById("love").value;
  const moment = document.getElementById("moment").value;
  const photoFile = document.getElementById("photoUpload").files[0];
  let photoBase64 = "";
  if(photoFile) photoBase64 = await fileToBase64(photoFile);

  let audioBase64 = "";
  if(audioBlob){
    audioBase64 = await new Promise(res =>{
      const reader=new FileReader();
      reader.onload=e=>res(e.target.result);
      reader.readAsDataURL(audioBlob);
    });
  }

  if(love.trim()==="" || moment.trim()===""){
    alert("âŒ Please answer all questions!");
    return;
  }

  try {
    const response = await fetch("https://sheetdb.io/api/v1/m1mdy2b4n7l6u", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        data:{
          timestamp: new Date().toLocaleString(),
          loveAnswer: love,
          moment: moment,
          photoBase64: photoBase64,
          audioBase64: audioBase64,
          favoritePhotoLink: "https://rpkfjjt9tx-del.github.io/Best/photo1.jpg",
          surprisePhotoLink: "https://rpkfjjt9tx-del.github.io/Best/surprise.jpg"
        }
      })
    });
    if(response.ok){
      alert("âœ… Submitted successfully!");
      document.getElementById("love").value="";
      document.getElementById("moment").value="";
      document.getElementById("photoUpload").value="";
      audioBlob=null;
      document.getElementById("audioPlayer").style.display="none";
      // Go to surprise page
      document.getElementById("page3").style.display="none";
      document.getElementById("page4").style.display="block";
    } else alert("âŒ Submission failed. Try again.");
  } catch(e){
    console.error(e);
    alert("âŒ Error connecting to SheetDB.");
  }
}
</script>

</body>
</html>
